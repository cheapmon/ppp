<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: PrivacyExtractor
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "PrivacyExtractor";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (P)</a> &raquo;
    
    
    <span class="title">PrivacyExtractor</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="class_list.html"></iframe>

      <div id="content"><h1>Module: PrivacyExtractor
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>PrivacyExtractor.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Module for plaintext extraction</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>Simon Kaleschke</p>
</div>
      
    </li>
  
</ul>

</div>



  <h2>Class Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#archive_date_block-class_method" title="archive_date_block (class method)">.<strong>archive_date_block</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Lambda block to manipulate the date format found in the archive.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#archive_url_block-class_method" title="archive_url_block (class method)">.<strong>archive_url_block</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Lambda block to manipulate said found urls.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#archive_xpath-class_method" title="archive_xpath (class method)">.<strong>archive_xpath</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Xpath to find links to older versions.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#mode-class_method" title="mode (class method)">.<strong>mode</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Extract all versions from scratch (:fetch) or just look for a new version
(:update).</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#own_archive-class_method" title="own_archive (class method)">.<strong>own_archive</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Whether the website has its own archive for Policies (true) or not (false).</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#plain_block-class_method" title="plain_block (class method)">.<strong>plain_block</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Lambda block to manipulate the found html containers.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#table_name-class_method" title="table_name (class method)">.<strong>table_name</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The name of the table in which the information is stored in the database.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#url-class_method" title="url (class method)">.<strong>url</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The url to extract the plaintext from, or, if it has its own archive, the
urls to older versions.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#xpath-class_method" title="xpath (class method)">.<strong>xpath</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Xpath for the main html containers in which the Policy is found.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build-class_method" title="build (class method)">.<strong>build</strong>(link)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create the final plaintext.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#convert_date-class_method" title="convert_date (class method)">.<strong>convert_date</strong>(date)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Convert display date (Month Day, Year) &gt;&gt; system date (YYYY-MM-DD)
One is for the user and the other for the website.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extract-class_method" title="extract (class method)">.<strong>extract</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Main extraction process, glues everything together.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#getLinks-class_method" title="getLinks (class method)">.<strong>getLinks</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Extract links to older versions from own archive or from archive.org.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="class_attr_details" class="attr_details">
    <h2>Class Attribute Details</h2>
    
      
      <span id="archive_date_block=-class_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="archive_date_block-class_method">
  
    .<strong>archive_date_block</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Lambda block to manipulate the date format found in the archive</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_archive_date_block'>archive_date_block</span>
  <span class='ivar'>@archive_date_block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="archive_url_block=-class_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="archive_url_block-class_method">
  
    .<strong>archive_url_block</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Lambda block to manipulate said found urls</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 34</span>

<span class='kw'>def</span> <span class='id identifier rubyid_archive_url_block'>archive_url_block</span>
  <span class='ivar'>@archive_url_block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="archive_xpath=-class_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="archive_xpath-class_method">
  
    .<strong>archive_xpath</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Xpath to find links to older versions</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 32</span>

<span class='kw'>def</span> <span class='id identifier rubyid_archive_xpath'>archive_xpath</span>
  <span class='ivar'>@archive_xpath</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="mode=-class_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="mode-class_method">
  
    .<strong>mode</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Extract all versions from scratch (:fetch) or just look for a new version
(:update)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mode'>mode</span>
  <span class='ivar'>@mode</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="own_archive=-class_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="own_archive-class_method">
  
    .<strong>own_archive</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Whether the website has its own archive for Policies (true) or not (false)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 30</span>

<span class='kw'>def</span> <span class='id identifier rubyid_own_archive'>own_archive</span>
  <span class='ivar'>@own_archive</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="plain_block=-class_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="plain_block-class_method">
  
    .<strong>plain_block</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Lambda block to manipulate the found html containers</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 28</span>

<span class='kw'>def</span> <span class='id identifier rubyid_plain_block'>plain_block</span>
  <span class='ivar'>@plain_block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="table_name=-class_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="table_name-class_method">
  
    .<strong>table_name</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The name of the table in which the information is stored in the database</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 24</span>

<span class='kw'>def</span> <span class='id identifier rubyid_table_name'>table_name</span>
  <span class='ivar'>@table_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="url=-class_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="url-class_method">
  
    .<strong>url</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The url to extract the plaintext from, or, if it has its own archive, the
urls to older versions</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 22</span>

<span class='kw'>def</span> <span class='id identifier rubyid_url'>url</span>
  <span class='ivar'>@url</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="xpath=-class_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="xpath-class_method">
  
    .<strong>xpath</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Xpath for the main html containers in which the Policy is found</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 26</span>

<span class='kw'>def</span> <span class='id identifier rubyid_xpath'>xpath</span>
  <span class='ivar'>@xpath</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="build-class_method">
  
    .<strong>build</strong>(link)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create the final plaintext</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 103</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='id identifier rubyid_link'>link</span><span class='rparen'>)</span>
	<span class='comment'># Open the link and parse a nodeset
</span>	<span class='id identifier rubyid_plain'>plain</span> <span class='op'>=</span> <span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_link'>link</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
	<span class='id identifier rubyid_dom'>dom</span> <span class='op'>=</span> <span class='const'>Nokogiri</span><span class='op'>::</span><span class='const'>HTML</span><span class='lparen'>(</span><span class='id identifier rubyid_plain'>plain</span><span class='rparen'>)</span>
	<span class='comment'># Extract relevant nodes
</span>	<span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='id identifier rubyid_dom'>dom</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rparen'>)</span>
	<span class='comment'># Modify found nodes and return the result
</span>	<span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_plain_block'>plain_block</span><span class='lbracket'>[</span><span class='id identifier rubyid_doc'>doc</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="convert_date-class_method">
  
    .<strong>convert_date</strong>(date)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Convert display date (Month Day, Year) &gt;&gt; system date (YYYY-MM-DD)
One is for the user and the other for the website</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 115</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_convert_date'>convert_date</span><span class='lparen'>(</span><span class='id identifier rubyid_date'>date</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_date'>date</span><span class='rparen'>)</span>
	<span class='lbracket'>[</span><span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>&lt;</span><span class='int'>2</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span><span class='op'>+</span><span class='id identifier rubyid_s'>s</span> <span class='op'>:</span> <span class='id identifier rubyid_s'>s</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extract-class_method">
  
    .<strong>extract</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Main extraction process, glues everything together</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 121</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_extract'>extract</span>	
	<span class='comment'># If no table for this website exists yet, create it
</span>	<span class='ivar'>@db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CREATE TABLE IF NOT EXISTS `</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>` 
		(`ID` INTEGER PRIMARY KEY, `SYSTEM_DATE` TEXT, `DISPLAY_DATE` TEXT, `LINK` TEXT, `CONTENT` TEXT);</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='comment'># If data is written anew from scratch, delete everything in the table
</span>	<span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='symbol'>:fetch</span>
		<span class='ivar'>@db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DELETE FROM `</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>`;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='kw'>end</span>
	<span class='comment'># Create the urls to extract from
</span>	<span class='id identifier rubyid_getLinks'>getLinks</span><span class='lparen'>(</span><span class='rparen'>)</span>
	<span class='comment'># Prepare iteration
</span>	<span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='ivar'>@links</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
	<span class='id identifier rubyid_newest_plain'>newest_plain</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_distinct_versions'>distinct_versions</span> <span class='op'>=</span> <span class='int'>1</span> 
	<span class='comment'># Iterate over all links, generate plaintext and compare them, save only distinct versions
</span>	<span class='id identifier rubyid_range'>range</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
		<span class='comment'># Get link and dates
</span>		<span class='id identifier rubyid_link'>link</span> <span class='op'>=</span> <span class='ivar'>@links</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_display_date'>display_date</span> <span class='op'>=</span> <span class='ivar'>@dates</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_system_date'>system_date</span> <span class='op'>=</span> <span class='id identifier rubyid_convert_date'>convert_date</span><span class='lparen'>(</span><span class='id identifier rubyid_display_date'>display_date</span><span class='rparen'>)</span>
		<span class='comment'># Build the plaintext
</span>		<span class='id identifier rubyid_plain'>plain</span> <span class='op'>=</span> <span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='id identifier rubyid_link'>link</span><span class='rparen'>)</span>
		<span class='comment'># Skip if nothing was extracted
</span>		<span class='kw'>if</span> <span class='id identifier rubyid_plain'>plain</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
			<span class='kw'>next</span>
		<span class='kw'>end</span>
		<span class='comment'># If it&#39;s the first iteration, set the first entry as the first distinct version, otherwise take the latest entry
</span>		<span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='id identifier rubyid_range'>range</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
			<span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='symbol'>:update</span>
				<span class='id identifier rubyid_newest_id'>newest_id</span> <span class='op'>=</span> <span class='ivar'>@db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT COUNT(*) FROM </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
				<span class='id identifier rubyid_newest_plain'>newest_plain</span> <span class='op'>=</span> <span class='ivar'>@db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT CONTENT FROM </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> WHERE ID=?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_newest_id'>newest_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
			<span class='kw'>else</span>
				<span class='id identifier rubyid_newest_plain'>newest_plain</span> <span class='op'>=</span> <span class='id identifier rubyid_plain'>plain</span>
				<span class='ivar'>@db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO `</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>` (SYSTEM_DATE, DISPLAY_DATE, LINK, CONTENT) VALUES(?,?,?,?);</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> 
				<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_system_date'>system_date</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_display_date'>display_date</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_link'>link</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_plain'>plain</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
				<span class='kw'>next</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
		<span class='comment'># Compare the newest and the current plaintext
</span>		<span class='id identifier rubyid_different'>different</span> <span class='op'>=</span> <span class='const'>PrivacyDiffer</span><span class='op'>::</span><span class='id identifier rubyid_different?'>different?</span><span class='lparen'>(</span><span class='id identifier rubyid_newest_plain'>newest_plain</span><span class='comma'>,</span><span class='id identifier rubyid_plain'>plain</span><span class='rparen'>)</span>
		<span class='comment'># If they&#39;re different, push the new one to the database and set it as newest
</span>		<span class='kw'>if</span> <span class='id identifier rubyid_different'>different</span>
			<span class='id identifier rubyid_newest_plain'>newest_plain</span> <span class='op'>=</span> <span class='id identifier rubyid_plain'>plain</span>
			<span class='id identifier rubyid_distinct_versions'>distinct_versions</span> <span class='op'>+=</span> <span class='int'>1</span>
			<span class='comment'># Notify new version
</span>			<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Found </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_distinct_versions'>distinct_versions</span><span class='embexpr_end'>}</span><span class='tstring_content'> distinct versions so far.</span><span class='tstring_end'>&quot;</span></span>
			<span class='comment'># Save to database
</span>			<span class='ivar'>@db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO `</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>` (SYSTEM_DATE, DISPLAY_DATE, LINK, CONTENT) VALUES(?,?,?,?);</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> 
				<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_system_date'>system_date</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_display_date'>display_date</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_link'>link</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_plain'>plain</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='comment'># Notify success
</span>	<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=&gt; Successfully finished with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_distinct_versions'>distinct_versions</span><span class='embexpr_end'>}</span><span class='tstring_content'> distinct versions.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="getLinks-class_method">
  
    .<strong>getLinks</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Extract links to older versions from own archive or from archive.org</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'PrivacyExtractor.rb', line 67</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_getLinks'>getLinks</span>
	<span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_own_archive'>own_archive</span>
		<span class='comment'># Open the archive website and parse it into a nodeset
</span>		<span class='id identifier rubyid_dom'>dom</span> <span class='op'>=</span> <span class='const'>Nokogiri</span><span class='op'>::</span><span class='const'>HTML</span> <span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
		<span class='comment'># Extract link nodes
</span>		<span class='id identifier rubyid_dom'>dom</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_archive_xpath'>archive_xpath</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_el'>el</span><span class='op'>|</span>
			<span class='comment'># Modify found links
</span>			<span class='ivar'>@links</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_archive_url_block'>archive_url_block</span><span class='lbracket'>[</span><span class='id identifier rubyid_el'>el</span><span class='period'>.</span><span class='id identifier rubyid_attr'>attr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>href</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='rbracket'>]</span><span class='rparen'>)</span>
			<span class='comment'># Modify found dates
</span>			<span class='ivar'>@dates</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_archive_date_block'>archive_date_block</span><span class='lbracket'>[</span><span class='id identifier rubyid_el'>el</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='rbracket'>]</span><span class='rparen'>)</span>
			<span class='comment'># If only the newest version is required, stop here
</span>			<span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='symbol'>:update</span>
				<span class='kw'>break</span>
			<span class='kw'>end</span>
		<span class='kw'>end</span>
	<span class='kw'>else</span>
		<span class='comment'># Get timestamps of old versions from archive.org
</span>		<span class='id identifier rubyid_stamps'>stamps</span> <span class='op'>=</span> <span class='const'>ArchiveExtractor</span><span class='op'>::</span><span class='id identifier rubyid_stamps'>stamps</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
		<span class='comment'># Using these stamps, generate links to those versions
</span>		<span class='ivar'>@links</span> <span class='op'>=</span> <span class='const'>ArchiveExtractor</span><span class='op'>::</span><span class='id identifier rubyid_links'>links</span><span class='lparen'>(</span><span class='id identifier rubyid_stamps'>stamps</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
		<span class='comment'># Using these stamps, generate a proper date format
</span>		<span class='ivar'>@dates</span> <span class='op'>=</span> <span class='const'>ArchiveExtractor</span><span class='op'>::</span><span class='id identifier rubyid_dates'>dates</span><span class='lparen'>(</span><span class='id identifier rubyid_stamps'>stamps</span><span class='rparen'>)</span>
		<span class='comment'># If only the newest version is required, stop here
</span>		<span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='symbol'>:update</span>
			<span class='ivar'>@links</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='ivar'>@links</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
			<span class='ivar'>@dates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='ivar'>@dates</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
	<span class='comment'># Ensure the older versions are further down the list
</span>	<span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_own_archive'>own_archive</span>
		<span class='ivar'>@links</span> <span class='op'>=</span> <span class='ivar'>@links</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span>
		<span class='ivar'>@dates</span> <span class='op'>=</span> <span class='ivar'>@dates</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Feb 24 23:50:19 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.3.0).
</div>

    </div>
  </body>
</html>